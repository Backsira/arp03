<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="vacationMapper">

<insert id="insertVacation">
insert into vacation
values(seq_vacation.nextval,
	   #{m_no},
	   #{vacation_title},
	   #{reason},
	   sysdate,
	   null
	   )
	   <selectKey keyProperty="v_no" resultType="int" order="AFTER">
	   		select seq_vacation.currval from dual
	   </selectKey>
</insert>

<select id ="selectLecNo" resultType="VacationDate">

SELECT lec_no , classdate vacation_date FROM CLASSDATE
WHERE LEC_NO IN (SELECT LEC_NO FROM MYCLASS
WHERE m_no = #{m_no}) AND
classdate = #{vacation_date}<!-- #{classdate} --> -- vacation date로 바꾸기

</select>

<insert id ="insertVacationDate">
insert into vacationdate
values(#{v_no},
	   #{lec_no},
	  #{vacation_date},
	  default,
	  default,
	  default,
	  default
	  <!-- #{classdate} -->)
</insert>

<!-- <insert id ="insertDate">
insert into vacationdate
values(#{v_no},
	   #{lec_no},
	   #{classdate})
</insert> -->

<select id="selectList" resultType="Vacation">
select v.*, m.name 
from vacation v , member m 
where v.m_no =#{v_no} and v.m_no=m.m_no
order by v.v_no desc
<!--select b.*, m.name 
		from board b, member m
		where b.ca_no=2 and b.status='Y' and b.m_no=m.m_no
		order by b_no desc  -->

</select>

<select id="selectLecture" resultType="Lecture">
select l.*
from myclass m, lecture l
where l.lec_no=m.lec_no and m.m_no=#{m_no}
</select>

<select id="detailVacation" resultType="VacationDate">
select vd.* , v.vacation_title , v.reason , l.title , m.name
from vacationdate vd , vacation v , lecture l , member m
where vd.v_no=#{v_no} and vd.v_no = v.v_no and l.lec_no = vd.lec_no and m.m_no = v.m_no
</select>

<update id="updateVacation">
update vacation
set reason=#{reason},start_date=#{start_date},date_count=#{date_count},APPLICATION_DATE=sysdate
where v_no=#{v_no}
</update>

<delete id="deleteVacation">

delete vacationdate
where lec_no = #{lec_no} 


</delete>

<select id="statusCheck" resultType="VacationDate">

select status
from vacationdate
where v_no=#{v_no}
group by (status)

</select>



<select id="studentVacationList" resultType="Vacation">
select v.* , m.name 
from vacation v, vacationdate vd , member m ,lecture l 
where vd.v_no= v.v_no and m.m_no = v.m_no and vd.lec_no = l.lec_no and l.m_no =#{m_no}
group by (v.v_no , v.m_no , v.vacation_title , v.reason , v.application_date , v.sign , m.name)
order by v.v_no desc
</select>

<select id="adminList" resultType="Vacation">
select v.* , vd.tstatus , vd.astatus,vd.status , m.name , vd.vacation_date , vd.lec_no , l.title
from vacation v, vacationdate vd , member m ,lecture l 
where vd.v_no= v.v_no and m.m_no = v.m_no and vd.lec_no = l.lec_no
</select>

<update id="permission">

update vacationdate
set tstatus='Y'
where v_no=#{v_no} and lec_no=#{lec_no} and vacation_date = #{vacation_date}

</update>

<update id="companion">
update vacationdate
set tstatus='B', companion_reason=#{companion_reason}
where v_no= #{v_no} and lec_no=#{lec_no} and vacation_date = #{vacation_date}

</update>

<update id="adminpermission">
update vacationdate
set astatus='Y', status='Y'
where v_no=#{v_no} 
</update>

<update id ="multipermission">
update vacationdate
set astatus='Y', status='Y'
where v_no=#{v_no} and lec_no=#{lec_no} and vacation_date=#{vacation_date}
</update>


</mapper>
